# Makefile for runnung QEMU amd64 images
version: '3'

# QEMU kernel commandline
vars:
  kernel_cmdline: console=ttyS0

env:
  SHELL : /bin/bash
#-------------------
# Run the QEMU image
#-------------------

tasks:
  run_qemu_internal:
    desc: Run a build qemu image
    cmds:
      - echo "Running {{.disc_image}} in QEMU aarch64 using EFI loader..."
      - |
        qemu-system-aarch64 \
        -machine virt \
        -cpu cortex-a72 \
        -m 4096 \
        -nographic \
        -netdev user,id=mynet0{{.qemu_net_append}} \
        -device virtio-net-pci,netdev=mynet0 \
        -drive format=raw,file={{.disc_image}},if=virtio
        -bios /usr/share/qemu-efi-aarch64/QEMU_EFI.fd
